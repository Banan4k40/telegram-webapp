<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Телефония</title>
    <style>
        /* Стили остаются без изменений */
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Поддержка Телефонии</h1>

    <button class="complaint-button" id="complaintButton" onclick="showLineButtons()">Жалобы</button>
    <div class="line-buttons" id="lineButtons">
        <button class="complaint-button" onclick="showForm('DID')">Линия DID</button>
        <button class="complaint-button" onclick="showForm('PH')">Линия PH</button>
    </div>
    <div class="form-container" id="formContainer">
        <input type="text" id="phoneNumber" placeholder="Введите номер телефона" required>
        <input type="text" id="callTime" placeholder="Введите время звонка (HH:MM)" required>
        <textarea id="comment" placeholder="Добавьте комментарий" rows="4"></textarea>
        <button id="submitButton">Отправить заявку</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // Читаем group_ids из URL
        const urlParams = new URLSearchParams(window.location.search);
        const groupIds = JSON.parse(urlParams.get("group_ids") || "{}");

        let selectedLine = "";

        function showLineButtons() {
            document.getElementById("complaintButton").style.display = "none";
            document.getElementById("lineButtons").style.display = "flex";
        }

        function showForm(lineType) {
            selectedLine = lineType;
            document.getElementById("lineButtons").style.display = "none";
            document.getElementById("formContainer").style.display = "flex";
        }

        document.getElementById("submitButton").addEventListener("click", async () => {
            const phoneNumber = document.getElementById("phoneNumber").value;
            const callTime = document.getElementById("callTime").value;
            const comment = document.getElementById("comment").value;

            if (!phoneNumber || !callTime) {
                alert("Заполните все поля!");
                return;
            }

            const payload = {
                line_type: selectedLine,
                phone_number: phoneNumber,
                call_time: callTime,
                comment: comment,
                user_id: tg.initDataUnsafe.user?.id,
                username: tg.initDataUnsafe.user?.username
            };

            try {
                const response = await fetch(`https://api.telegram.org/bot${tg.initDataUnsafe.token}/sendMessage`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (response.ok) tg.close();
                else alert("Ошибка отправки заявки.");
            } catch (error) {
                console.error("Ошибка:", error);
                alert("Не удалось отправить заявку.");
            }
        });
    </script>
</body>
</html>
