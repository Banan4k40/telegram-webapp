<script>
    const BOT_TOKEN = "7633978350:AAGRf2rNJmFkCl2LVTGEXMw49z_FZJpQby0";
    const GROUP_ID_DID = -1002424881153;
    const GROUP_ID_PH = -1002417008521;
    let selectedLine = "";

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å WebApp API
    if (!window.Telegram || !Telegram.WebApp) {
        alert("Telegram WebApp SDK –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.");
        throw new Error("Telegram WebApp SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–∏–Ω–∏–∏
    function showLineButtons() {
        document.getElementById("complaintButton").style.display = "none";
        document.getElementById("lineButtons").style.display = "flex";
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
    function showForm(lineType) {
        selectedLine = lineType;
        document.getElementById("lineButtons").style.display = "none";
        document.getElementById("formContainer").style.display = "flex";
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
    document.getElementById('submitButton').addEventListener('click', async () => {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const callTime = document.getElementById('callTime').value;
        const comment = document.getElementById('comment').value;

        const userName = Telegram.WebApp.initDataUnsafe?.user?.first_name || "Anonymous";
        const userId = Telegram.WebApp.initDataUnsafe?.user?.id || "Unknown";

        if (!phoneNumber || !callTime) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.");
            return;
        }

        const message = `
        üÜï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞:
        üìû –õ–∏–Ω–∏—è: ${selectedLine}
        ‚òéÔ∏è –ù–æ–º–µ—Ä: ${phoneNumber}
        ‚è∞ –í—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞: ${callTime}
        üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}
        üë§ User: ${userName} (ID: ${userId})`;

        const groupId = selectedLine === "DID" ? GROUP_ID_DID : GROUP_ID_PH;

        try {
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    chat_id: groupId,
                    text: message,
                    parse_mode: "HTML",
                    reply_markup: JSON.stringify({
                        inline_keyboard: [[
                            { text: "–û—Ç–≤–µ—Ç–∏—Ç—å", callback_data: `answer_${userId}` }
                        ]]
                    })
                })
            });

            if (response.ok) {
                alert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
                document.getElementById("formContainer").style.display = "none";
                document.getElementById("complaintButton").style.display = "flex";
            } else {
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏.");
            }
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É.");
        }
    });
</script>
